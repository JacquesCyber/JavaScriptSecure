{
  "info": {
    "name": "SecureBank API Security Tests",
    "description": "Comprehensive security tests for authentication, authorization, input validation, and business logic",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Authentication Tests",
      "item": [
        {
          "name": "Test Rate Limiting on Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// After 5 failed attempts, should get 429",
                  "if (pm.variables.get('attemptCount') >= 5) {",
                  "    pm.test('Rate limit enforced after 5 attempts', function () {",
                  "        pm.response.to.have.status(429);",
                  "    });",
                  "} else {",
                  "    pm.test('Invalid credentials rejected', function () {",
                  "        pm.response.to.have.status(401);",
                  "    });",
                  "    pm.variables.set('attemptCount', (pm.variables.get('attemptCount') || 0) + 1);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"attacker\",\n  \"password\": \"wrongpassword\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/users/login",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "login"]
            }
          }
        },
        {
          "name": "Test SQL Injection in Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('SQL injection blocked', function () {",
                  "    pm.response.to.not.have.status(200);",
                  "    pm.expect(pm.response.json()).to.not.have.property('token');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin' OR '1'='1\",\n  \"password\": \"anything\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/users/login",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "login"]
            }
          }
        },
        {
          "name": "Test NoSQL Injection in Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('NoSQL injection blocked', function () {",
                  "    pm.response.to.not.have.status(200);",
                  "    pm.expect(pm.response.json()).to.not.have.property('token');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": {\"$gt\": \"\"},\n  \"password\": {\"$gt\": \"\"}\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/users/login",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "Input Validation Tests",
      "item": [
        {
          "name": "Test XSS in Registration",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('XSS payload rejected or sanitized', function () {",
                  "    const response = pm.response.json();",
                  "    if (pm.response.code === 201) {",
                  "        // If created, ensure script tags are sanitized",
                  "        pm.expect(response.user.fullName).to.not.include('<script>');",
                  "    } else {",
                  "        // Or should be rejected",
                  "        pm.response.to.have.status(400);",
                  "    }",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"<script>alert('XSS')</script>\",\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"password\": \"SecurePass123!\",\n  \"accountNumber\": \"1234567890\",\n  \"idNumber\": \"9001010000080\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/users/register",
              "host": ["{{base_url}}"],
              "path": ["api", "users", "register"]
            }
          }
        },
        {
          "name": "Test Invalid IBAN Format",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid IBAN rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('validation');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"beneficiaryAccount\": \"INVALID123\",\n  \"swiftCode\": \"ABCDEF12\",\n  \"amount\": 1000\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/international-payments/create",
              "host": ["{{base_url}}"],
              "path": ["api", "international-payments", "create"]
            }
          }
        },
        {
          "name": "Test Invalid SWIFT Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid SWIFT code rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message || response.errors).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"swiftCode\": \"INVALID\",\n  \"beneficiaryAccount\": \"GB82WEST12345698765432\",\n  \"amount\": 1000\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/international-payments/create",
              "host": ["{{base_url}}"],
              "path": ["api", "international-payments", "create"]
            }
          }
        }
      ]
    },
    {
      "name": "Business Logic Tests",
      "item": [
        {
          "name": "Test Negative Payment Amount",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Negative amount rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": -1000,\n  \"currency\": \"USD\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/payments/process",
              "host": ["{{base_url}}"],
              "path": ["api", "payments", "process"]
            }
          }
        },
        {
          "name": "Test Excessive Payment Amount",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Excessive amount rejected', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('exceeds');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 99999999999,\n  \"currency\": \"USD\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/payments/process",
              "host": ["{{base_url}}"],
              "path": ["api", "payments", "process"]
            }
          }
        }
      ]
    },
    {
      "name": "CSRF Protection Tests",
      "item": [
        {
          "name": "Test Missing CSRF Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request without CSRF token rejected', function () {",
                  "    pm.response.to.have.status(403);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('CSRF' || 'token');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 100\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/payments/process",
              "host": ["{{base_url}}"],
              "path": ["api", "payments", "process"]
            }
          }
        }
      ]
    },
    {
      "name": "Authorization Tests",
      "item": [
        {
          "name": "Test Unauthenticated Access to Protected Route",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Unauthenticated access denied', function () {",
                  "    pm.response.to.have.status(401);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/payments/history",
              "host": ["{{base_url}}"],
              "path": ["api", "payments", "history"]
            }
          }
        }
      ]
    },
    {
      "name": "Security Headers Tests",
      "item": [
        {
          "name": "Test Security Headers Present",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('X-Content-Type-Options header present', function () {",
                  "    pm.response.to.have.header('X-Content-Type-Options');",
                  "    pm.expect(pm.response.headers.get('X-Content-Type-Options')).to.eql('nosniff');",
                  "});",
                  "",
                  "pm.test('X-Frame-Options header present', function () {",
                  "    pm.response.to.have.header('X-Frame-Options');",
                  "});",
                  "",
                  "pm.test('Content-Security-Policy header present', function () {",
                  "    pm.response.to.have.header('Content-Security-Policy');",
                  "});",
                  "",
                  "pm.test('X-XSS-Protection header present', function () {",
                  "    pm.response.to.have.header('X-XSS-Protection');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/",
              "host": ["{{base_url}}"],
              "path": [""]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ]
}
