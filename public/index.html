<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Secure Secret Form</title>
  <link href="/css/bootstrap.min.css" rel="stylesheet" />
  <link href="/css/styles.css" rel="stylesheet" />
</head>
<body class="bg-dark">
  <div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center">
    <div class="row w-100 justify-content-center">
      <div class="col-md-6 col-lg-4">
        <div class="card bg-primary border-info shadow-lg">
          <div class="card-header bg-info text-center">
            <h1 class="mb-0 text-dark fw-bold">üîê SECURE ACCESS</h1>
          </div>
          <div class="card-body p-4">
            <form id="secretForm" class="needs-validation" novalidate>
              <div class="mb-4">
                <label for="title" class="form-label text-info fw-semibold">
                  <i class="me-2">üë§</i>USERNAME
                </label>
                <input 
                  type="text" 
                  name="title" 
                  id="title" 
                  class="form-control form-control-lg bg-dark text-light border-secondary" 
                  placeholder="Enter your username"
                  required 
                />
                <div class="invalid-feedback">Please enter your username.</div>
              </div>
              <div class="mb-4">
                <label for="data" class="form-label text-info fw-semibold">
                  <i class="me-2">üîë</i>PASSWORD
                </label>
                <input 
                  type="password" 
                  name="data" 
                  id="data" 
                  class="form-control form-control-lg bg-dark text-light border-secondary" 
                  placeholder="Enter your password"
                  required 
                />
                <div class="invalid-feedback">Please enter your password.</div>
              </div>
              <div class="d-grid">
                <button type="submit" class="btn btn-info btn-lg text-dark fw-bold py-3">
                  üöÄ INITIATE SECURE CONNECTION
                </button>
              </div>
            </form>
          </div>
          <div class="card-footer bg-secondary text-center">
            <small class="text-muted">üõ°Ô∏è Protected by Advanced Encryption</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script nonce="{nonce}">
    // Bootstrap form validation with enhanced UX
    (function () {
      'use strict';
      const form = document.querySelector('#secretForm');
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;

      form.addEventListener('submit', async function (event) {
        event.preventDefault();
        event.stopPropagation();

        if (!form.checkValidity()) {
          form.classList.add('was-validated');
          // Add shake animation to invalid inputs
          const invalidInputs = form.querySelectorAll(':invalid');
          invalidInputs.forEach(input => {
            input.style.animation = 'shake 0.5s ease-in-out';
            setTimeout(() => input.style.animation = '', 500);
          });
          return;
        }

        // Show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '‚ö° CONNECTING...';
        submitBtn.classList.add('loading');

        try {
          const title = form.title.value;
          const data = form.data.value;

          const res = await fetch('/store', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, data }),
          });

          const json = await res.json();
          
          // Success state
          submitBtn.innerHTML = '‚úÖ CONNECTION ESTABLISHED';
          submitBtn.classList.remove('btn-info');
          submitBtn.classList.add('btn-success');
          
          // Show success message with better styling
          showNotification(`üîê Secure connection established!\nSession ID: ${json.id}`, 'success');

          // Reset form after delay
          setTimeout(() => {
            form.reset();
            form.classList.remove('was-validated');
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
            submitBtn.classList.remove('btn-success', 'loading');
            submitBtn.classList.add('btn-info');
          }, 3000);

        } catch (error) {
          // Error state
          submitBtn.innerHTML = '‚ùå CONNECTION FAILED';
          submitBtn.classList.remove('btn-info');
          submitBtn.classList.add('btn-danger');
          
          showNotification('üö® Connection failed. Please try again.', 'error');
          
          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnText;
            submitBtn.classList.remove('btn-danger', 'loading');
            submitBtn.classList.add('btn-info');
          }, 3000);
        }
      });

      // Enhanced notification system
      function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
        notification.style.cssText = `
          top: 20px;
          right: 20px;
          z-index: 9999;
          min-width: 300px;
          box-shadow: 0 0 20px rgba(0,0,0,0.3);
          border: 2px solid ${type === 'success' ? '#28a745' : '#dc3545'};
          animation: slideIn 0.3s ease-out;
        `;
        notification.innerHTML = message.replace('\n', '<br>');
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOut 0.3s ease-in';
          setTimeout(() => notification.remove(), 300);
        }, 4000);
      }

      // Add CSS animations
      const style = document.createElement('style');
      style.textContent = `
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);

      // Add input focus effects
      const inputs = form.querySelectorAll('.form-control');
      inputs.forEach(input => {
        input.addEventListener('focus', function() {
          this.parentElement.style.transform = 'scale(1.02)';
          this.parentElement.style.transition = 'transform 0.2s ease';
        });
        
        input.addEventListener('blur', function() {
          this.parentElement.style.transform = 'scale(1)';
        });
      });
    })();
  </script>
</body>
</html>